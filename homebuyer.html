<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8" />
	<title>Home Buyer's Guide</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.0/css/bootstrap-slider.min.css" integrity="sha256-D25WHQReXOtVfJZu6lFdpu3ZN4kvVA7/+Af5mPjYlbw=" crossorigin="anonymous" />
	<link rel="stylesheet" href="./homebuyer.css" />

	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script type="text/javascript">
		function loadData() {
			var data_file = "./homebuyer.json";
			var http_request = new XMLHttpRequest();

			http_request.onreadystatechange = function () {
				if (http_request.readyState == 4) {
					var json_data = JSON.parse(http_request.responseText);
					Vue.filter('money', function (value) {
						if (!value) return ''
						value = value.toLocaleString('en')
						return value
					})
					var homes = new Vue({
						el: '#homes',
						data: json_data,
						size: [0, 0],
						price: [0, 0],
						computed: {
							uniquebedrooms: function () {
								var items = this.homes, bedrooms = []

								for (var i = 0; i < this.homes.length; i++)
									bedrooms.push(this.homes[i].bedrooms)

								return bedrooms.filter((value, index, self) => self.indexOf(value) === index)
							},
							minmaxsize: function () {
								var items = this.homes, values = [0, 0]

								if (this.homes.length < 1)
									return values

								values[0] = this.homes[0].size;
								values[1] = values[0]

								for (var i = 1; i < this.homes.length; i++) {
									if (this.homes[i].size < values[0])
										values[0] = this.homes[i].size
									if (this.homes[i].size > values[1])
										values[1] = this.homes[i].size
								}

								return values
							},
							minmaxprice: function () {
								var items = this.homes, values = [0, 0]

								if (this.homes.length < 1)
									return values

								values[0] = this.homes[0].price;
								values[1] = values[0]

								for (var i = 1; i < this.homes.length; i++) {
									if (this.homes[i].price < values[0])
										values[0] = this.homes[i].price
									if (this.homes[i].price > values[1])
										values[1] = this.homes[i].price
								}

								return values
							}
						}
					});

					$('#sizeFilter').slider({
						min: homes.minmaxsize[0],
						max: homes.minmaxsize[1],
						value: homes.minmaxsize
					});

					$('#priceFilter').slider({
						min: homes.minmaxprice[0],
						max: homes.minmaxprice[1],
						value: homes.minmaxprice
					});
				}
			}

			http_request.open("GET", data_file, true);
			http_request.send();
		}
	</script>
</head>
<body onload="loadData()">
	<nav class="navbar navbar-light bg-light sticky-top flex-md-nowrap">
		<a class="navbar-brand" href="#">Portland Home Buyer's Guide</a>
	</nav>

	<div class="container-fluid">
		<div id="homes" class="row">
			<div id="filters" class="bg-light sidebar col col-sm-5 col-md-4 col-lg-3 col-xl-2">
				<form>
					<div class="form-group">
						<label for="bedroomsFilter">Bedrooms:</label>
						<select class="form-control" id="bedroomsFilter">
							<option v-for="bd in uniquebedrooms" v-cloak="true">{{ bd }}</option>
						</select>
						<label for="sizeFilter">Size: {{ minmaxsize[0] }}</label>
						<input id="sizeFilter" data-slider-id="sizeFilterSlider" type="text" value="" v-model.lazy="size" :data-slider-min="'mixmaxsize[0]'" :data-slider-max="'minmaxsize[1]'" :data-slider-value="'minmaxsize'" />
						<label>{{ minmaxsize[1] }}</label>
						<label for="priceFilter">Price: {{ minmaxprice[0] }}</label>
						<input id="priceFilter" data-slider-id="priceFilterSlider" type="text" value="" v-model.lazy="price" :data-slider-min="'minmaxprice[0]'" :data-slider-max="'minmaxprice[1]'" :data-slider-value="'minmaxprice'" />
						<label>{{ minmaxprice[1] }}</label>
					</div>
				</form>
			</div>
			<div class="container col p-0">
				<div class="container-fluid d-flex flex-row flex-wrap">
					<div v-for="(home, index) in homes" v-cloak="true" :id="'home'+index" class="card">
						<img :src="'./homepictures/'+home.picture" class="card-image-top" />
						<div class="card-body d-flex flex-column justify-content-between">
							<h5 class="homeaddress card-title">{{ home.address.street }}<br />{{ home.address.city }}, {{ home.address.state }} {{ home.address.zip }}</h5>
							<div class="homeinfo cardtext">Bedrooms: {{ home.bedrooms }}<br />Bathrooms: {{ home.bathrooms }}<br />Size: {{ home.size }}sqft<br />Price: ${{ home.price | money }}</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.0/bootstrap-slider.min.js" integrity="sha256-G5ZTzV4wJSLf9AuZ3wMEJVZDp1MumYGrEw+JsAGHRXI=" crossorigin="anonymous"></script>
</body>
</html>